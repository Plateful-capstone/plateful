<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="partials/head :: head ('Show individual recipe')"></head>
<body>
<div th:replace="loading :: loading-animation"></div>
<div class="page-wrapper">
    <header th:replace="partials/navbar :: navbar"></header>
    <div class="container indiv-recipe-container grow justify-center">
        <div class="row grow justify-center">
            <div class="column shrink justify-center shrink main-background individual-recipe-title align-center">
                <h4 th:text="${recipe.recipeName}"></h4>
            </div>
        </div>
        <div class="row indiv-card-row ">
            <div class="column card-divider indiv-recipe-image-wrapper shrink main-background justify-center gap-20 pink-border">
                <img th:src="${recipe.recipeImageUrl}" alt="recipe image">

                <div class="column  gap-20 recipe-content">
                    <p th:utext="'<b>' + 'Ingredients: ' +' </b>' + ${recipe.recipeIngredients}"></p>
                    <p th:utext="'<b>' + 'Description: ' +' </b>' + ${recipe.recipeDescription}"></p>
                    <p th:utext="'<b>' + 'Instructions: '+ '</b>' + ${recipe.recipeInstructions}"></p>
                    <p th:utext="'<b>' + 'Created by:  '+ '</b> '+ ${recipe.user.username}"></p>
                </div>


                <!--buttons start-->
                <div class="div" th:switch="${#authorization.expression('isAuthenticated')}" >
                <div class="row indiv-recipe-btns-row" th:case="true">
                    <!-- Case 1: Authenticated User -->
                    <div class="column justify-center align-center">
                        <!-- Go Back Button (Visible to all users) -->
                        <button class="cta"><a th:href="@{/recipes}">Go back</a></button>
                    </div>

                    <!-- Edit Button (Visible to authenticated users if the recipe belongs to them) -->
                    <form class="column justify-center align-center"
                          th:if="${#authentication.principal.id == recipe.user.id}"
                          th:action="@{/recipes/{id}/edit(id=${recipe.id})}" method="post">
                        <input type="hidden" name="_method" value="put"/>
                        <button class="editModalBtn cta" th:data-modal-id="'editModal-' + ${recipe.id}" type="button">
                            Edit
                        </button>
                    </form>
                    <!-- Edit Modal -->
                    <div th:id="'editModal-' + ${recipe.id}" class="modal main-background">
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <!-- Edit Form -->
                            <form th:action="@{/recipes/{id}/edit(id=${recipe.id})}" method="post"
                                  class="d-flex flex-column gap-10">
                                <h2>Make changes to your recipe!</h2>
                                <h3>Title: </h3>
                                <input type="text" name="recipeName" placeholder="Title"
                                       th:value="${recipe.recipeName}"/>
                                <h3>Description: </h3>
                                <input type="text" name="recipeDescription" placeholder="Description"
                                       th:value="${recipe.recipeDescription}"/>
                                <h3>Ingredients: </h3>
                                <input type="text" name="recipeIngredients" placeholder="Ingredients"
                                       th:value="${recipe.recipeIngredients}"/>
                                <h3>Instructions: </h3>
                                <textarea class="no-padding" type="text" name="recipeInstructions"
                                          th:text="${recipe.recipeInstructions}"></textarea>
                                <h3>Image URL: </h3>
                                <button type="button" id="open" class="image-add cta" value="Change Image">Change Image</button>
                                <input type="hidden" name="recipeImageUrl" placeholder="Image URL" id="recipeImageURL"
                                       th:value="${recipe.recipeImageUrl}"/>
                                <button type="submit" class="cta">Submit Changes</button>
                            </form>
                        </div>
                    </div>

                    <!-- Delete Button -->
                    <form class="column justify-center align-center" th:if="${#authentication.principal.id == recipe.user.id}" th:action="@{/recipes/{id}/delete(id=${recipe.id})}" method="post">
                        <button class="cta" id="delete-modal-btn">Delete recipe</button>
                    </form>

                    <!-- Delete Modal -->
                    <div id="delete-modal-container" class="modal">
                        <div class="modal-content">
                            <span class="close" id="delete-modal-close">&times;</span>
                            <!-- Delete Form -->
                            <form th:action="@{/recipes/{id}/delete(id=${recipe.id})}" method="post" class="d-flex flex-column gap-10">
                                <h2>Are you sure you want to delete this recipe?</h2>
                                <button class="cta" type="submit">Delete</button>
                            </form>
                        </div>
                    </div>




                    <!-- Comment Button (Visible to authenticated users) -->
                    <div class="comment-wrapper column justify-center align-center">
                        <button class="cta" id="comment-btn">Comment</button>
                    </div>

                    <!-- Add to Cookbook Button (Visible to authenticated users) -->
                    <form class="d-flex justify-center column" action="#">
                        <button class="cta">Add to Cookbook</button>
                    </form>
                </div>

                <!-- Case 2: Not Authenticated User -->
                <div class="row indiv-recipe-btns-row" th:case="false" >
                    <div class="column justify-center align-center">
                        <button class="cta"><a th:href="@{/recipes}">Go back</a></button>
                    </div>
                </div>
                </div>

                <!--buttons end-->

                <!--                comments start-->
                <div id="comments-row" class="row gap-10" style="display: none">
                    <div class="ghost-div-indiv-recipe grow">
                        <div class="column gap-20">
                            <form th:action="@{/recipes/{id}/comments/create(id=${recipe.id})}" method="post" class="row grow d-flex justify-center">
                                <textarea name="comment-body" id="comment-content" placeholder="Post Something..."></textarea>
                                <button class="cta" id="comment-content-btn" style="display: none">Comment</button>
                            </form>
                        </div>
                            <!--                        display comments-->
                            <div class="column" th:each="comment : ${comments}" th:href="@{/recipes/{id}/view(id=${recipe.id})}" >
                                <div class="row gap-10">
                                    <div class="column comment-profile-image-wrapper">
                                        <img th:src="${comment.user.avatar_url}" alt="profile image">
                                    </div>
                                    <div class="column comment-content-from-db body-text">
                                        <h5 th:text="${comment.user.username}"></h5>
                                        <p th:text="${comment.body}"></p>
                                    </div>
                                </div>
                            </div>
                    </div>
                </div>
            </div>
            <!--            comments end-->

        </div>
    </div>
    <footer th:replace="partials/footer :: footer"></footer>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script th:src="@{/js/loadingAnimation.js}"></script>
<script th:replace="loading :: lottie-script"></script>
<script th:src="@{/js/editModal.js}"></script>
<script th:src="@{/js/deleteModal.js}"></script>
<script src="//static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>
<script type="module" src="/js/edit-recipe-filestack.js"></script>
<script type="module" src="/js/comments.js"></script>

</body>
</html>